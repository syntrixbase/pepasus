# Pegasus â€” Event-Driven Autonomous Agent System

**Pegasus** æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€çŠ¶æ€æœºé©±åŠ¨çš„è‡ªä¸»ä»£ç†ç³»ç»Ÿã€‚å®ƒä¸æ˜¯ä¼ ç»Ÿçš„"è¯·æ±‚-å“åº”"æœåŠ¡ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­è¿è¡Œçš„è‡ªä¸»å·¥ä½œè€…ï¼Œèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€è°ƒç”¨å·¥å…·ã€è‡ªä¸»å†³ç­–å’Œå­¦ä¹ æ”¹è¿›ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **äº‹ä»¶é©±åŠ¨æ¶æ„** â€” ä¸€åˆ‡çš†äº‹ä»¶ï¼Œé€šè¿‡ EventBus åˆ†å‘ï¼Œæ— é˜»å¡å¹¶å‘
- ğŸ¤– **çŠ¶æ€æœºä»»åŠ¡ç®¡ç†** â€” TaskFSM ç²¾ç¡®æ§åˆ¶ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼Œå¯æŒ‚èµ·/æ¢å¤
- ğŸ§  **ä¸‰é˜¶æ®µè®¤çŸ¥å¾ªç¯** â€” Reason â†’ Act â†’ Reflect
- ğŸ­ **èº«ä»½ç³»ç»Ÿ** â€” å¯é…ç½®çš„ personaï¼Œä¿æŒä¸€è‡´çš„äººæ ¼å’Œè¡Œä¸ºé£æ ¼
- ğŸ”§ **å†…ç½®å·¥å…·ç³»ç»Ÿ** â€” æ–‡ä»¶ã€ç½‘ç»œã€ç³»ç»Ÿã€æ•°æ®å·¥å…· + LLM å‡½æ•°è°ƒç”¨
- ğŸ’¾ **è®°å¿†ç³»ç»Ÿ** â€” é•¿æœŸè®°å¿†ï¼ˆfacts + episodesï¼‰ï¼ŒåŸºäº Markdown æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- [Bun](https://bun.sh/) v1.0+
- **é€‰æ‹©ä»¥ä¸‹ä»»ä¸€é€‰é¡¹**ï¼š
  - **OpenAI API Key**ï¼ˆæ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼‰â€” [platform.openai.com/api-keys](https://platform.openai.com/api-keys)
  - **Anthropic API Key** â€” [console.anthropic.com/settings/keys](https://console.anthropic.com/settings/keys)
  - **æœ¬åœ°æ¨¡å‹**ï¼ˆæ— éœ€ API keyï¼‰â€” [Ollama](https://ollama.com/) æˆ– [LM Studio](https://lmstudio.ai/)

### å®‰è£…ä¾èµ–

```bash
bun install
```

### é…ç½®

Pegasus ä½¿ç”¨åˆ†å±‚é…ç½®ï¼š`config.yml`ï¼ˆbaseï¼‰â†’ `config.local.yml`ï¼ˆoverrideï¼‰â†’ Zod æ ¡éªŒã€‚

ç¯å¢ƒå˜é‡ååœ¨ YAML ä¸­é€šè¿‡ `${VAR:-default}` è¯­æ³•è‡ªç”±å®šä¹‰ï¼Œä»£ç ä¸ hardcode ç¯å¢ƒå˜é‡åã€‚

**é€‰é¡¹ 1: OpenAIï¼ˆæ¨èï¼‰**

åˆ›å»º `config.local.yml`ï¼š

```yaml
llm:
  provider: openai
  providers:
    openai:
      apiKey: sk-proj-your-key
      model: gpt-4o-mini
```

**é€‰é¡¹ 2: æœ¬åœ° Ollamaï¼ˆå…è´¹ï¼Œæ— éœ€ API keyï¼‰**

```bash
# å®‰è£… Ollama
brew install ollama  # macOS
# æˆ–è®¿é—® https://ollama.com/download

# å¯åŠ¨ Ollama å¹¶æ‹‰å–æ¨¡å‹
ollama serve &
ollama pull llama3.2
```

åˆ›å»º `config.local.yml`ï¼š

```yaml
llm:
  provider: ollama
  providers:
    ollama:
      model: llama3.2:latest
      baseURL: http://localhost:11434/v1
```

**é€‰é¡¹ 3: Anthropic Claude**

åˆ›å»º `config.local.yml`ï¼š

```yaml
llm:
  provider: anthropic
  providers:
    anthropic:
      apiKey: sk-ant-api03-your-key
      model: claude-sonnet-4-20250514
```

### è¿è¡Œ CLIï¼ˆM1 - å¯¹è¯èƒ½åŠ›ï¼‰

```bash
bun run dev
```

ä½ ä¼šçœ‹åˆ°ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸš€ Pegasus CLI              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Persona: Pegasus (intelligent digital employee)
  Type /help for commands, /exit to quit

> ä½ å¥½
  Pegasus: ä½ å¥½ï¼æˆ‘æ˜¯ Pegasusï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·æŸ¥çœ‹ [docs/running.md](./docs/running.md)ã€‚

## ğŸ§ª å¼€å‘

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
bun test

# è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡
bun run coverage

# ç±»å‹æ£€æŸ¥
bun run typecheck

# è¿è¡Œæ‰€æœ‰æ£€æŸ¥ï¼ˆç±»å‹æ£€æŸ¥ + æµ‹è¯•ï¼‰
make check
```

### ä»£ç è´¨é‡

é¡¹ç›®è¦æ±‚ï¼š
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 95%ï¼ˆå½“å‰ï¼š**99.53%**ï¼‰
- âœ… æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡ï¼ˆå½“å‰ï¼š**359 tests**ï¼‰
- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡

Git hooks ä¼šåœ¨ push å‰è‡ªåŠ¨è¿è¡Œæ£€æŸ¥ã€‚

## ğŸ“Š é¡¹ç›®çŠ¶æ€

| é‡Œç¨‹ç¢‘ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| **M0: éª¨æ¶è·‘é€š** | âœ… å®Œæˆ | EventBus + TaskFSM + Agent æ ¸å¿ƒæ¶æ„ |
| **M1: èƒ½å¯¹è¯** | âœ… å®Œæˆ | CLI å¯¹è¯ + Identity ç³»ç»Ÿ + LLM é›†æˆ |
| **M3: èƒ½è¡ŒåŠ¨** | âœ… å®Œæˆ | å†…ç½®å·¥å…·ç³»ç»Ÿ + LLM å‡½æ•°è°ƒç”¨ + äº‹ä»¶é©±åŠ¨ Actor |
| **M2: æœ‰è®°å¿†** | âœ… å®Œæˆ | é•¿æœŸè®°å¿†ç³»ç»Ÿï¼ˆfacts + episodesï¼‰ |
| **M4: ä¼šæ€è€ƒ** | ğŸ“‹ å¾…å¼€å§‹ | å¤æ‚ä»»åŠ¡åˆ†è§£å’Œè§„åˆ’ |
| **M5: èƒ½å¹¶å‘** | ğŸ“‹ å¾…éªŒè¯ | å¤šä»»åŠ¡å¹¶å‘å¤„ç† |
| **M6: èƒ½æŒ‚èµ·** | ğŸ“‹ å¾…å¼€å§‹ | ä»»åŠ¡æŒ‚èµ·/æ¢å¤æœºåˆ¶ |
| **M7: èƒ½å­¦ä¹ ** | ğŸ“‹ å¾…å¼€å§‹ | ä»å†å²ç»éªŒä¸­å­¦ä¹ æ”¹è¿› |

å½“å‰æµ‹è¯•è¦†ç›–ç‡ï¼š**99.53%** âœ… | æµ‹è¯•æ•°ï¼š**359 pass**

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ä¸€åˆ‡çš†äº‹ä»¶** â€” ç”¨æˆ·æ¶ˆæ¯ã€å·¥å…·è¿”å›ã€çŠ¶æ€å˜æ›´éƒ½æ˜¯ Event
2. **ä»»åŠ¡å³çŠ¶æ€æœº** â€” æ¯ä¸ªä»»åŠ¡æ˜¯ç‹¬ç«‹çš„ TaskFSMï¼Œæœ‰æ˜ç¡®çš„çŠ¶æ€è½¬æ¢è§„åˆ™
3. **Agent æ˜¯äº‹ä»¶å¤„ç†å™¨** â€” æ²¡æœ‰é˜»å¡å¾ªç¯ï¼Œåªæœ‰äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€è½¬æ¢
4. **æ— é˜»å¡ã€çº¯å¼‚æ­¥** â€” å¤šä»»åŠ¡äº¤é”™æ‰§è¡Œï¼Œå…±äº«ç®—åŠ›
5. **è®¤çŸ¥å¤„ç†å™¨æ— çŠ¶æ€** â€” Thinker/Planner/Actor/Reflector å¯è¢«ä»»æ„ä»»åŠ¡å¤ç”¨

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Interface Layer (CLI / API / ...)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       EventBus (ä¼˜å…ˆçº§é˜Ÿåˆ—)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Agent (äº‹ä»¶å¤„ç†å™¨ + çŠ¶æ€è½¬æ¢)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TaskFSM Layer (ä»»åŠ¡çŠ¶æ€æœº)          â”‚
â”‚  IDLE â†’ REASONING â†’ ACTING          â”‚
â”‚     â†’ REFLECTING â†’ COMPLETED        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cognitive Processors (è®¤çŸ¥å¤„ç†å™¨)   â”‚
â”‚  Thinker â”‚ Planner â”‚ Actor          â”‚
â”‚  Reflector                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Identity Layer (èº«ä»½ç³»ç»Ÿ)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Memory System (é•¿æœŸè®°å¿†)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tool System (å†…ç½®å·¥å…· + æ‰§è¡Œå™¨)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LLM Adapter (OpenAI / Anthropic)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Capability Layer (MCP - è§„åˆ’ä¸­)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¯¦ç»†è®¾è®¡è¯·æŸ¥çœ‹ï¼š
- [æ¶æ„æ€»è§ˆ](./docs/architecture.md)
- [äº‹ä»¶ç³»ç»Ÿ](./docs/events.md)
- [ä»»åŠ¡çŠ¶æ€æœº](./docs/task-fsm.md)
- [Agent æ ¸å¿ƒ](./docs/agent.md)
- [è®¤çŸ¥å¤„ç†å™¨](./docs/cognitive.md)

## ğŸ“ é¡¹ç›®ç»“æ„

```
pegasus/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agent.ts            # Agent æ ¸å¿ƒï¼ˆäº‹ä»¶å¤„ç† + çŠ¶æ€è½¬æ¢ï¼‰
â”‚   â”œâ”€â”€ cli.ts              # CLI äº¤äº’ç•Œé¢
â”‚   â”œâ”€â”€ events/             # äº‹ä»¶ç³»ç»Ÿï¼ˆEvent + EventBusï¼‰
â”‚   â”œâ”€â”€ task/               # ä»»åŠ¡çŠ¶æ€æœºï¼ˆTaskFSM + Contextï¼‰
â”‚   â”œâ”€â”€ cognitive/          # è®¤çŸ¥å¤„ç†å™¨ï¼ˆ3 é˜¶æ®µï¼šReason â†’ Act â†’ Reflectï¼‰
â”‚   â”œâ”€â”€ identity/           # èº«ä»½ç³»ç»Ÿï¼ˆPersona + Promptï¼‰
â”‚   â”œâ”€â”€ tools/              # å·¥å…·ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ registry.ts     # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â”œâ”€â”€ executor.ts     # å·¥å…·æ‰§è¡Œå™¨ï¼ˆäº‹ä»¶é©±åŠ¨ + è¶…æ—¶æ§åˆ¶ï¼‰
â”‚   â”‚   â””â”€â”€ builtins/       # å†…ç½®å·¥å…·ï¼ˆsystem/file/network/data/memoryï¼‰
â”‚   â””â”€â”€ infra/              # åŸºç¡€è®¾æ–½ï¼ˆConfig + Logger + LLM clientsï¼‰
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/               # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ integration/        # é›†æˆæµ‹è¯•
â”œâ”€â”€ docs/                   # è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ data/
â”‚   â””â”€â”€ personas/           # Persona é…ç½®æ–‡ä»¶
â””â”€â”€ .github/workflows/      # CI/CD é…ç½®
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|---------|
| Runtime | Bun |
| Language | TypeScript 5.x |
| Schema | Zod |
| Logger | pino |
| Test | bun:test |
| LLM | OpenAI / Anthropic official SDKs |

## ğŸ¤ å¼€å‘å·¥ä½œæµ

### æäº¤ä»£ç 

```bash
# 1. ç¡®ä¿æ‰€æœ‰æ£€æŸ¥é€šè¿‡
make check

# 2. æäº¤ä»£ç 
git add .
git commit -m "feat: your feature description"

# 3. Pushï¼ˆgit hooks ä¼šè‡ªåŠ¨è¿è¡Œæ£€æŸ¥ï¼‰
git push
```

### åˆ›å»º Pull Request

PR åˆ° `main` åˆ†æ”¯ä¼šè‡ªåŠ¨è§¦å‘ CI æ£€æŸ¥ï¼š
- âœ… ç±»å‹æ£€æŸ¥
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… ä»£ç è¦†ç›–ç‡ â‰¥ 95%

åªæœ‰æ‰€æœ‰æ£€æŸ¥é€šè¿‡æ‰èƒ½åˆå¹¶ã€‚

## ğŸ“š æ–‡æ¡£

- [è¿è¡ŒæŒ‡å—](./docs/running.md) - é…ç½®å’Œä½¿ç”¨è¯´æ˜
- [é…ç½®æŒ‡å—](./docs/configuration.md) - YAML é…ç½® + ç¯å¢ƒå˜é‡æ’å€¼
- [æ—¥å¿—ç³»ç»Ÿ](./docs/logging.md) - æ—¥å¿—æ ¼å¼ã€è¾“å‡ºç›®æ ‡ã€log rotation
- [ç³»ç»Ÿæ¶æ„](./docs/architecture.md) - æ¶æ„è®¾è®¡æ€»è§ˆ
- [è®°å¿†ç³»ç»Ÿ](./docs/memory-system.md) - é•¿æœŸè®°å¿†è®¾è®¡
- [é¡¹ç›®ç»“æ„](./docs/project-structure.md) - ä»£ç ç»„ç»‡è¯´æ˜

## ğŸ“„ è®¸å¯è¯

MIT

---

**Status**: M2 å®Œæˆ âœ… | è¦†ç›–ç‡ 99.53% âœ… | ä¸‹ä¸€æ­¥: M4 ä¼šæ€è€ƒ
